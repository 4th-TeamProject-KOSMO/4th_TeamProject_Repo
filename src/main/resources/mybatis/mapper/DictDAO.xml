<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 컨트롤러가 호출하는 인터페이스의 위치를 namespace로 지정한다. -->
<mapper namespace="com.edu.springboot.dict.IDictService">

	<select id="selectOne" parameterType="int"
		resultType="com.edu.springboot.dict.DictDTO">
		SELECT * from plantdict where plantidx = #{plantidx}
	</select>

	<select id="selectAll"
		resultType="com.edu.springboot.dict.DictDTO">
		SELECT * from plantdict
	</select>
	
	<select id="selectAllPlantidx"
		resultType="Integer">
		SELECT plantidx from plantdict
	</select>

	<select id="selectPlantsByUser"
		resultType="com.edu.springboot.dict.DictDTO">
		SELECT d.plantidx, d.name, d.imgpath, d.summary
		FROM PLANTDICT d
		WHERE d.plantidx IN (
		SELECT DISTINCT plantidx
		FROM DIARY
		WHERE userid = #{userId}
		)
		ORDER BY d.plantidx
	</select>
	
	<!-- 관리자: 식물도감 등록 -->
   <insert id="insertPlantDict" parameterType="com.edu.springboot.dict.DictDTO">
    INSERT INTO plantdict (plantidx, name, engname, category, imgpath)
    VALUES (PLANTDICT_SEQ.NEXTVAL, #{name}, #{engname}, #{category}, #{imgpath})
</insert>


    <!-- 관리자: 식물도감 전체 조회 (최신순) -->
    <select id="selectAllPlants" resultType="com.edu.springboot.dict.DictDTO">
	    SELECT plantidx, name, engname, category, 
	           CONCAT('/images/dict/', imgpath) AS imgpath
	    FROM plantdict
	    ORDER BY plantidx DESC
	</select>


    <!-- 관리자: 식물도감 삭제 -->
    <delete id="deletePlantDict" parameterType="int">
	    DELETE FROM plantdict WHERE plantidx = #{plantidx}
	</delete>
<!-- 
 -->
</mapper>